## PROVISONING A KUBERNETES CLUSTER WITH TERRAFORM
#### Elastic Kubernetes Service on Amazon Web Services
https://learn.hashicorp.com/tutorials/terraform/eks
#### Azure Kubernetes Service on Azure
https://learn.hashicorp.com/tutorials/terraform/aks?in=terraform/kubernetes
#### Google Kubernetes Engine on Google Cloud Platform
https://learn.hashicorp.com/tutorials/terraform/gke?in=terraform/kubernetes

## Generating kubeconfg file

#### IN EKS
* Can Refer this too : https://www.youtube.com/watch?v=zmOc6wHRbag
* Its autogenerated in a file inside the working directory
* Can copy the config file to /.kube/config manually or
* Give this shell command 
```
terraform output kubeconfig > ~/.kube/config
```
* Once its done check if u can connect with the resource
```
kubectl get svc
```
#### IN AKS
* Head over to tfvars file and check if credentials are given
If Not :
```
Run az login and connect your azure account from cmd
Copy appId and Update in terraform.tfvars file
Copy Password and Update in terraform.tfvars file
```
* Un comment these lines in outputs.tf file
```
# output "kube_config" {
#   value = azurerm_kubernetes_cluster.default.kube_config_raw
# }
```
* Once its done check if u can connect with the resource
```
kubectl get svc
```

## Installing Plugins
* Install Plugins for Jenkins
* Manage Jenkins > Manage Plugins > Available
```
kubernetes
Kubernetes CLI
```

## Setting Up Jenkins
* Create Credentials with the config file generated
* Manage Jenkins > Manage Credentials > Jenkins > Global Credentials > Add Credentials
```
kind: Secret File
Browse the config file and upload
ID: aws-kube / az-kube
``` 
* Save It.

## Pipeline Scripts
* Open Project > Pipeline Syntax > withKubeConfig
* Select the credentials created for kubernetes
* Kubernetes server endpoint : Copy and Paste from kubeconfig file
* Generate Pipeline Script


#### Example :
```
stage('deploying it to kubernetes'){
            steps{
                sh 'cat k8s/api-deployment.yaml'
                withKubeConfig(caCertificate: '', clusterName: '', contextName: '', credentialsId: 'kube-gcp', namespace: '', serverUrl: 'https://35.222.102.119') {
    
                    sh 'kubectl apply -f k8s/database-deployment.yaml'
                    
                }
                sleep(120)
                withKubeConfig(caCertificate: '', clusterName: '', contextName: '', credentialsId: 'kube-gcp', namespace: '', serverUrl: 'https://35.222.102.119') {
                            
                    sh 'kubectl apply -f k8s/api-deployment.yaml'
                    sh 'kubectl get pods'
                    sh 'kubectl get svc'
                    
                }

            }
        }
```